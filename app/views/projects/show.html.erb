<div class="max-w-5xl mx-auto mt-10 bg-white shadow-lg rounded-2xl p-8">

  <!-- Project Header -->
  <div class="mb-6 border-b pb-4">
    <h1 class="text-4xl font-extrabold text-purple-700 mb-2"><%= @project.name %></h1>
    <p class="text-gray-700 text-lg"><%= @project.description %></p>
  </div>

  <!-- Project Manager -->
  <div class="mb-6">
    <span class="text-gray-500 font-semibold">Project Manager:</span>
    <span class="ml-2 text-gray-800 font-medium"><%= @project.manager.name %></span>
  </div>

  <!-- Bugs Section -->
  <div class="mb-6">
    <h2 class="text-2xl font-semibold text-gray-800 mb-4">Bugs in this Project</h2>

    <% if can? :read, @project %>

      <!-- Search & Filters -->
      <%= form_with url: project_path(@project), method: :get, local: true, class: "flex flex-wrap gap-2 mb-4" do |f| %>
        <%= f.select :priority, options_for_select(Bug.priorities.keys.map { |p| [p.titleize, p] }, params[:priority]), { include_blank: "All Priorities" }, class: "border rounded px-3 py-2" %>
        <%= f.select :status, options_for_select(Bug.statuses.keys.map { |s| [s.titleize, s] }, params[:status]), { include_blank: "All Statuses" }, class: "border rounded px-3 py-2" %>
        <%= f.select :severity, options_for_select(Bug.severities.keys.map { |s| [s.titleize, s] }, params[:severity]), { include_blank: "All Severities" }, class: "border rounded px-3 py-2" %>
        <%= f.select :bug_type, options_for_select(Bug.bug_types.keys.map { |s| [s.titleize, s] }, params[:bug_type]), { include_blank: "All Bug Types" }, class: "border rounded px-3 py-2" %>
        <%= f.submit "Filter", class: "bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded shadow" %>
      <% end %>

      <% if @bugs.present? %>
        <!-- Bug Grid -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
          <% @bugs.each do |bug| %>
            <div class="bg-gradient-to-tr p-[2px] rounded-xl from-gray-200 to-gray-100 shadow hover:shadow-lg transition h-full flex flex-col justify-between">
              <div class="bg-white rounded-xl p-4 flex flex-col justify-between h-full">

                <!-- Header: Title & Priority -->
                <div class="flex justify-between items-start mb-3">
                  <h3 class="font-bold text-lg line-clamp-1 text-gray-900">
                    <%= link_to bug.title, bug_path(bug), class: "text-indigo-600 hover:underline" %>
                  </h3>
                  <span class="px-2 py-1 text-xs rounded-full font-semibold <%= bug.priority == 'high' ? 'bg-red-100 text-red-700' : bug.priority == 'medium' ? 'bg-yellow-100 text-yellow-700' : 'bg-green-100 text-green-700' %>">
                    <%= bug.priority.titleize %>
                  </span>
                </div>

                <!-- Description -->
                <p class="text-gray-800 text-sm mb-3 line-clamp-3"><%= bug.description %></p>

                <!-- Details Badges -->
                <div class="flex flex-wrap gap-2 text-xs mb-3">
                  <!-- Status -->
                  <span class="px-2 py-1 rounded-full font-semibold <%= bug.status == 'open' ? 'bg-blue-100 text-blue-700' : bug.status == 'closed' ? 'bg-gray-200 text-gray-800' : 'bg-purple-100 text-purple-700' %>">
                    Status: <%= bug.status.humanize %>
                  </span>
                  <!-- Severity -->
                  <span class="px-2 py-1 rounded-full font-semibold <%= bug.severity == 'minor' ? 'bg-green-100 text-green-700' : bug.severity == 'major' ? 'bg-yellow-100 text-yellow-700' : 'bg-red-100 text-red-700' %>">
                    Severity: <%= bug.severity.humanize %>
                  </span>
                  <!-- Bug Type -->
                  <span class="px-2 py-1 rounded-full font-semibold <%= bug.bug_type == 'ui' ? 'bg-pink-100 text-pink-700' : bug.bug_type == 'backend' ? 'bg-indigo-100 text-indigo-700' : bug.bug_type == 'performance' ? 'bg-orange-100 text-orange-700' : 'bg-gray-100 text-gray-800' %>">
                    Type: <%= bug.bug_type.humanize %>
                  </span>
                  <!-- Due Date -->
                  <span class="px-2 py-1 rounded-full font-semibold <%= bug.due_date && bug.due_date < Date.today ? 'bg-red-100 text-red-700' : 'bg-green-100 text-green-700' %>">
                    Due: <%= bug.due_date&.strftime("%d %b %Y") || "Not set" %>
                  </span>
                </div>

                <!-- Actions -->
                <div class="flex gap-2 mt-3">
                  <%= link_to "Edit", edit_bug_path(bug), class: "text-center bg-yellow-100 text-yellow-700 px-3 py-1 rounded-md text-xs hover:bg-yellow-200 transition" %>
                  <%= button_to "Delete", bug_path(bug), method: :delete, data: { turbo_confirm: "Are you sure you want to delete this bug?" }, class: "text-center bg-red-100 text-red-700 px-3 py-1 rounded-md text-xs hover:bg-red-200 transition" %>
                </div>

              </div>
            </div>
          <% end %>
        </div>

        <!-- Pagination -->
        <div class="mt-6">
          <%= render "kaminari/paginator", collection: @bugs %>
        </div>
      <% else %>
        <p class="text-gray-400 italic">No bugs found for this project.</p>
      <% end %>

      <!-- Actions -->
      <div class="flex flex-wrap gap-3 mt-6">
        <%= link_to "Create New Bug", new_bug_path(project_id: @project.id), class: "bg-green-600 hover:bg-green-700 text-white px-5 py-2 rounded-lg shadow transition-all duration-200" %>
        <%= link_to "Edit Project", edit_project_path(@project), class: "bg-yellow-500 hover:bg-yellow-600 text-white px-5 py-2 rounded-lg shadow transition-all duration-200" %>
        <% if can? :destroy, @project %>
          <%= button_to "Delete Project", project_path(@project), method: :delete, data: { turbo_confirm: "Are you sure you want to delete this project?" }, class: "bg-red-500 hover:bg-red-600 text-white px-5 py-2 rounded-lg shadow transition-all duration-200" %>
        <% end %>
      </div>

    <% else %>
      <p class="text-gray-400 italic">You are not allowed to view the bugs of this project.</p>
    <% end %>
  </div>

  <div class="mt-3">
    <%= link_to "Back to Projects", projects_path, class: "bg-gray-400 hover:bg-gray-500 text-white px-5 py-2 rounded-lg shadow transition-all duration-200" %>
  </div>
</div>
